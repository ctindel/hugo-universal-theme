{{ if isset .Site.Params "features" }}
{{ if .Site.Params.features.enable }}
{{ if gt (len .Site.Data.features) 0 }}
<section class="bar background-white">
    <div class="container">
        {{ range $index, $element := sort .Site.Data.features "weight" }}


        {{ if $.Site.Params.features.two_features_per_row }} 
            {{ if eq (mod $index 2) 0 }}
        <div class="col-md-12">
            <div class="row">
            {{ end }}
        {{ else }}
            {{ if eq (mod $index 3) 0 }}
        <div class="col-md-12">
            <div class="row">
            {{ end }}
        {{ end }}
                {{ if $.Site.Params.features.two_features_per_row }}
                <div class="col-md-6">
                {{else}}
                <div class="col-md-4">
                {{ end }}
                    <div class="box-simple">
                        {{ with $element.url }}
                        <a href="{{ $element.url }}">
                        {{ end }}
                            <div class="icon">
                                <i class="{{ .icon }}"></i>
                            </div>
                        {{ with $element.url }}
                        </a>
                        {{ end }}
                        <h3>{{ $element.name | markdownify }}</h3>
                        <p>{{ $element.description | markdownify }}</p>
                    </div>
                </div>
        {{ if $.Site.Params.features.two_features_per_row }} 
            {{ if eq (mod $index 2) 1 }}
            </div>
        </div>
            {{ end }}
        {{ else }}
            {{ if or (eq (mod $index 3) 2) (eq $index (sub (len $.Site.Data.features) 1 )) }}
            </div>
        </div>
            {{ end }}
        {{ end }}
        {{ end }}
    </div>
</section>
{{ end }}
{{ end }}
{{ end }}
